import{u as v,p as C,a as T,b as _,c as S,d as w,r as D,F as o,j as e,D as f,e as r,I as p,m as E,f as I,g as O}from"./index-CZzdpmLT.js";import{u as A,F as N,v as L}from"./index-DLkTJrmI.js";import{m as P}from"./chunk-IGSAU2ZA-REcqhBJW.js";import"./chunk-SSA7SXE4-C6Xcka5I.js";import"./index-CCFQoF9b.js";const R=(t,i)=>{const[l,n]=v(a=>a.token),c=C(i,a=>{!a?.headers||!n||(a.headers.Authorization=`Bearer ${l}`)});return T(t,c)};function $({message:t}){const{isOpen:i,onOpen:l,onClose:n}=_(),{mergeExtensions:c}=S(),{config:{feedback:a}}=w(),[d,k]=D.useState(o.Like),x=R("/api/feedback",{headers:{"Content-Type":"application/json"},method:"POST"}),u=a[d].form,j=()=>{n()},m=async s=>{if(!t.serverId)throw new Error('Feedback is only available for messages with "serverId" set');try{await x.call({body:{message_id:t.serverId,feedback:d,payload:s??{}}})}catch(g){console.error(g)}},y=s=>{c(t.id,{feedbackType:d}),m(s.formData),n()},h=async s=>{if(k(s),a[s].form===null){await m(null);return}l()},F=A();if(!u)return null;const b=t.extensions?.feedbackType;return e.jsxs(e.Fragment,{children:[a.like.enabled&&e.jsx(f,{content:"Like",placement:"bottom",children:e.jsx(r,{isIconOnly:!0,variant:"ghost",className:"p-0","aria-label":"Rate message as helpful",onPress:()=>h(o.Like),"data-testid":"feedback-like",children:e.jsx(p,{icon:b===o.Like?"heroicons:hand-thumb-up-solid":"heroicons:hand-thumb-up"})})}),a.dislike.enabled&&e.jsx(f,{content:"Dislike",placement:"bottom",children:e.jsx(r,{isIconOnly:!0,variant:"ghost",className:"p-0","aria-label":"Rate message as unhelpful",onPress:()=>h(o.Dislike),"data-testid":"feedback-dislike",children:e.jsx(p,{icon:b===o.Dislike?"heroicons:hand-thumb-down-solid":"heroicons:hand-thumb-down"})})}),e.jsx(E,{isOpen:i,onOpenChange:j,children:e.jsx(I,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"text-default-900 flex flex-col gap-1",children:u.title}),e.jsx(O,{children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(N,{schema:u,validator:L,onSubmit:y,transformErrors:F,liveValidate:!0,children:e.jsxs("div",{className:"flex justify-end gap-4 py-4",children:[e.jsx(r,{color:"danger",variant:"light",onPress:s,"aria-label":"Close feedback form",children:"Cancel"}),e.jsx(r,{color:"primary",type:"submit","aria-label":"Submit feedback","data-testid":"feedback-submit",children:"Submit"})]})})})})]})})})]})}export{$ as default};
