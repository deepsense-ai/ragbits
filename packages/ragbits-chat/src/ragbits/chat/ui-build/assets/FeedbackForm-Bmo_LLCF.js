import{u as S,a as C,b as T,r as _,F as s,c as w,d as D,j as e,D as u,e as n,I as h,m as O,f as L,g as K}from"./index-CGTLCg14.js";import{u as N,F as A,v as P}from"./index-DTfggGVa.js";import{m as R}from"./chunk-IGSAU2ZA-CTQ-fg-W.js";import"./chunk-SSA7SXE4-W6etCkoX.js";function $({message:t}){const{isOpen:b,onOpen:f,onClose:i}=S(),{mergeExtensions:p}=C(),{config:{feedback:o}}=T(),[r,x]=_.useState(s.LIKE),k=w(),[j,y]=k(a=>a.token),F=D("/api/feedback",{headers:{"Content-Type":"application/json",Authorization:y?`Bearer ${j}`:""},method:"POST"}),l=o[r].form,g=()=>{i()},c=async a=>{if(!t.serverId)throw new Error('Feedback is only available for messages with "serverId" set');try{await F.call({body:{message_id:t.serverId,feedback:r,payload:a}})}catch(E){console.error(E)}},I=a=>{p(t.id,{feedbackType:r}),c(a.formData),i()},d=async a=>{if(x(a),o[a].form===null){await c(null);return}f()},v=N();if(!l)return null;const m=t.extensions?.feedbackType;return e.jsxs(e.Fragment,{children:[o.like.enabled&&e.jsx(u,{content:"Like",placement:"bottom",children:e.jsx(n,{isIconOnly:!0,variant:"ghost",className:"p-0","aria-label":"Rate message as helpful",onPress:()=>d(s.LIKE),"data-testid":"feedback-like",children:e.jsx(h,{icon:m===s.LIKE?"heroicons:hand-thumb-up-solid":"heroicons:hand-thumb-up"})})}),o.dislike.enabled&&e.jsx(u,{content:"Dislike",placement:"bottom",children:e.jsx(n,{isIconOnly:!0,variant:"ghost",className:"p-0","aria-label":"Rate message as unhelpful",onPress:()=>d(s.DISLIKE),"data-testid":"feedback-dislike",children:e.jsx(h,{icon:m===s.DISLIKE?"heroicons:hand-thumb-down-solid":"heroicons:hand-thumb-down"})})}),e.jsx(O,{isOpen:b,onOpenChange:g,children:e.jsx(L,{children:a=>e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"text-default-900 flex flex-col gap-1",children:l.title}),e.jsx(K,{children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(A,{schema:l,validator:P,onSubmit:I,transformErrors:v,liveValidate:!0,children:e.jsxs("div",{className:"flex justify-end gap-4 py-4",children:[e.jsx(n,{color:"danger",variant:"light",onPress:a,"aria-label":"Close feedback form",children:"Cancel"}),e.jsx(n,{color:"primary",type:"submit","aria-label":"Submit feedback","data-testid":"feedback-submit",children:"Submit"})]})})})})]})})})]})}export{$ as default};
