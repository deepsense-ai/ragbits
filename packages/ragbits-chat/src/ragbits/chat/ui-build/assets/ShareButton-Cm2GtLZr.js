import{au as Hr,u as Jr,r as hr,av as Wr,j as O,D as qr,d as gr,I as Yr,m as Kr,e as Lr,f as Qr,aw as Vr,ax as Xr}from"./index-CUygrr3M.js";import{m as Zr}from"./chunk-IGSAU2ZA-BsgB5I-t.js";var j=Uint8Array,B=Uint16Array,jr=Int32Array,lr=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sr=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),br=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dr=function(r,e){for(var a=new B(31),n=0;n<31;++n)a[n]=e+=1<<r[n-1];for(var t=new jr(a[30]),n=1;n<30;++n)for(var o=a[n];o<a[n+1];++o)t[o]=o-a[n]<<5|n;return{b:a,r:t}},Rr=Dr(lr,2),_r=Rr.b,dr=Rr.r;_r[28]=258,dr[258]=28;var zr=Dr(sr,0),re=zr.b,Mr=zr.r,Cr=new B(32768);for(var p=0;p<32768;++p){var Q=(p&43690)>>1|(p&21845)<<1;Q=(Q&52428)>>2|(Q&13107)<<2,Q=(Q&61680)>>4|(Q&3855)<<4,Cr[p]=((Q&65280)>>8|(Q&255)<<8)>>1}var q=(function(r,e,a){for(var n=r.length,t=0,o=new B(e);t<n;++t)r[t]&&++o[r[t]-1];var v=new B(e);for(t=1;t<e;++t)v[t]=v[t-1]+o[t-1]<<1;var l;if(a){l=new B(1<<e);var h=15-e;for(t=0;t<n;++t)if(r[t])for(var u=t<<4|r[t],f=e-r[t],i=v[r[t]-1]++<<f,s=i|(1<<f)-1;i<=s;++i)l[Cr[i]>>h]=u}else for(l=new B(n),t=0;t<n;++t)r[t]&&(l[t]=Cr[v[r[t]-1]++]>>15-r[t]);return l}),V=new j(288);for(var p=0;p<144;++p)V[p]=8;for(var p=144;p<256;++p)V[p]=9;for(var p=256;p<280;++p)V[p]=7;for(var p=280;p<288;++p)V[p]=8;var fr=new j(32);for(var p=0;p<32;++p)fr[p]=5;var ee=q(V,9,0),ae=q(V,9,1),ne=q(fr,5,0),te=q(fr,5,1),wr=function(r){for(var e=r[0],a=1;a<r.length;++a)r[a]>e&&(e=r[a]);return e},J=function(r,e,a){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&a},xr=function(r,e){var a=e/8|0;return(r[a]|r[a+1]<<8|r[a+2]<<16)>>(e&7)},Ar=function(r){return(r+7)/8|0},cr=function(r,e,a){return(e==null||e<0)&&(e=0),(a==null||a>r.length)&&(a=r.length),new j(r.subarray(e,a))},oe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],H=function(r,e,a){var n=new Error(e||oe[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,H),!a)throw n;return n},fe=function(r,e,a,n){var t=r.length,o=0;if(!t||e.f&&!e.l)return a||new j(0);var v=!a,l=v||e.i!=2,h=e.i;v&&(a=new j(t*3));var u=function(ar){var nr=a.length;if(ar>nr){var rr=new j(Math.max(nr*2,ar));rr.set(a),a=rr}},f=e.f||0,i=e.p||0,s=e.b||0,x=e.l,d=e.d,w=e.m,C=e.n,N=t*8;do{if(!x){f=J(r,i,1);var y=J(r,i+1,3);if(i+=3,y)if(y==1)x=ae,d=te,w=9,C=5;else if(y==2){var R=J(r,i,31)+257,A=J(r,i+10,15)+4,g=R+J(r,i+5,31)+1;i+=14;for(var c=new j(g),M=new j(19),T=0;T<A;++T)M[br[T]]=J(r,i+T*3,7);i+=A*3;for(var I=wr(M),L=(1<<I)-1,U=q(M,I,1),T=0;T<g;){var _=U[J(r,i,L)];i+=_&15;var m=_>>4;if(m<16)c[T++]=m;else{var k=0,S=0;for(m==16?(S=3+J(r,i,3),i+=2,k=c[T-1]):m==17?(S=3+J(r,i,7),i+=3):m==18&&(S=11+J(r,i,127),i+=7);S--;)c[T++]=k}}var z=c.subarray(0,R),E=c.subarray(R);w=wr(z),C=wr(E),x=q(z,w,1),d=q(E,C,1)}else H(1);else{var m=Ar(i)+4,D=r[m-4]|r[m-3]<<8,F=m+D;if(F>t){h&&H(0);break}l&&u(s+D),a.set(r.subarray(m,F),s),e.b=s+=D,e.p=i=F*8,e.f=f;continue}if(i>N){h&&H(0);break}}l&&u(s+131072);for(var er=(1<<w)-1,G=(1<<C)-1,Y=i;;Y=i){var k=x[xr(r,i)&er],P=k>>4;if(i+=k&15,i>N){h&&H(0);break}if(k||H(2),P<256)a[s++]=P;else if(P==256){Y=i,x=null;break}else{var $=P-254;if(P>264){var T=P-257,b=lr[T];$=J(r,i,(1<<b)-1)+_r[T],i+=b}var W=d[xr(r,i)&G],X=W>>4;W||H(3),i+=W&15;var E=re[X];if(X>3){var b=sr[X];E+=xr(r,i)&(1<<b)-1,i+=b}if(i>N){h&&H(0);break}l&&u(s+131072);var Z=s+$;if(s<E){var ir=o-E,vr=Math.min(E,Z);for(ir+s<0&&H(3);s<vr;++s)a[s]=n[ir+s]}for(;s<Z;++s)a[s]=a[s-E]}}e.l=x,e.p=Y,e.b=s,e.f=f,x&&(f=1,e.m=w,e.d=d,e.n=C)}while(!f);return s!=a.length&&v?cr(a,0,s):a.subarray(0,s)},K=function(r,e,a){a<<=e&7;var n=e/8|0;r[n]|=a,r[n+1]|=a>>8},tr=function(r,e,a){a<<=e&7;var n=e/8|0;r[n]|=a,r[n+1]|=a>>8,r[n+2]|=a>>16},pr=function(r,e){for(var a=[],n=0;n<r.length;++n)r[n]&&a.push({s:n,f:r[n]});var t=a.length,o=a.slice();if(!t)return{t:Pr,l:0};if(t==1){var v=new j(a[0].s+1);return v[a[0].s]=1,{t:v,l:1}}a.sort(function(F,R){return F.f-R.f}),a.push({s:-1,f:25001});var l=a[0],h=a[1],u=0,f=1,i=2;for(a[0]={s:-1,f:l.f+h.f,l,r:h};f!=t-1;)l=a[a[u].f<a[i].f?u++:i++],h=a[u!=f&&a[u].f<a[i].f?u++:i++],a[f++]={s:-1,f:l.f+h.f,l,r:h};for(var s=o[0].s,n=1;n<t;++n)o[n].s>s&&(s=o[n].s);var x=new B(s+1),d=mr(a[f-1],x,0);if(d>e){var n=0,w=0,C=d-e,N=1<<C;for(o.sort(function(R,A){return x[A.s]-x[R.s]||R.f-A.f});n<t;++n){var y=o[n].s;if(x[y]>e)w+=N-(1<<d-x[y]),x[y]=e;else break}for(w>>=C;w>0;){var m=o[n].s;x[m]<e?w-=1<<e-x[m]++-1:++n}for(;n>=0&&w;--n){var D=o[n].s;x[D]==e&&(--x[D],++w)}d=e}return{t:new j(x),l:d}},mr=function(r,e,a){return r.s==-1?Math.max(mr(r.l,e,a+1),mr(r.r,e,a+1)):e[r.s]=a},kr=function(r){for(var e=r.length;e&&!r[--e];);for(var a=new B(++e),n=0,t=r[0],o=1,v=function(h){a[n++]=h},l=1;l<=e;++l)if(r[l]==t&&l!=e)++o;else{if(!t&&o>2){for(;o>138;o-=138)v(32754);o>2&&(v(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(v(t),--o;o>6;o-=6)v(8304);o>2&&(v(o-3<<5|8208),o=0)}for(;o--;)v(t);o=1,t=r[l]}return{c:a.subarray(0,n),n:e}},or=function(r,e){for(var a=0,n=0;n<e.length;++n)a+=r[n]*e[n];return a},Ur=function(r,e,a){var n=a.length,t=Ar(e+2);r[t]=n&255,r[t+1]=n>>8,r[t+2]=r[t]^255,r[t+3]=r[t+1]^255;for(var o=0;o<n;++o)r[t+o+4]=a[o];return(t+4+n)*8},Er=function(r,e,a,n,t,o,v,l,h,u,f){K(e,f++,a),++t[256];for(var i=pr(t,15),s=i.t,x=i.l,d=pr(o,15),w=d.t,C=d.l,N=kr(s),y=N.c,m=N.n,D=kr(w),F=D.c,R=D.n,A=new B(19),g=0;g<y.length;++g)++A[y[g]&31];for(var g=0;g<F.length;++g)++A[F[g]&31];for(var c=pr(A,7),M=c.t,T=c.l,I=19;I>4&&!M[br[I-1]];--I);var L=u+5<<3,U=or(t,V)+or(o,fr)+v,_=or(t,s)+or(o,w)+v+14+3*I+or(A,M)+2*A[16]+3*A[17]+7*A[18];if(h>=0&&L<=U&&L<=_)return Ur(e,f,r.subarray(h,h+u));var k,S,z,E;if(K(e,f,1+(_<U)),f+=2,_<U){k=q(s,x,0),S=s,z=q(w,C,0),E=w;var er=q(M,T,0);K(e,f,m-257),K(e,f+5,R-1),K(e,f+10,I-4),f+=14;for(var g=0;g<I;++g)K(e,f+3*g,M[br[g]]);f+=3*I;for(var G=[y,F],Y=0;Y<2;++Y)for(var P=G[Y],g=0;g<P.length;++g){var $=P[g]&31;K(e,f,er[$]),f+=M[$],$>15&&(K(e,f,P[g]>>5&127),f+=P[g]>>12)}}else k=ee,S=V,z=ne,E=fr;for(var g=0;g<l;++g){var b=n[g];if(b>255){var $=b>>18&31;tr(e,f,k[$+257]),f+=S[$+257],$>7&&(K(e,f,b>>23&31),f+=lr[$]);var W=b&31;tr(e,f,z[W]),f+=E[W],W>3&&(tr(e,f,b>>5&8191),f+=sr[W])}else tr(e,f,k[b]),f+=S[b]}return tr(e,f,k[256]),f+S[256]},ie=new jr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Pr=new j(0),ve=function(r,e,a,n,t,o){var v=o.z||r.length,l=new j(n+v+5*(1+Math.ceil(v/7e3))+t),h=l.subarray(n,l.length-t),u=o.l,f=(o.r||0)&7;if(e){f&&(h[0]=o.r>>3);for(var i=ie[e-1],s=i>>13,x=i&8191,d=(1<<a)-1,w=o.p||new B(32768),C=o.h||new B(d+1),N=Math.ceil(a/3),y=2*N,m=function(ur){return(r[ur]^r[ur+1]<<N^r[ur+2]<<y)&d},D=new jr(25e3),F=new B(288),R=new B(32),A=0,g=0,c=o.i||0,M=0,T=o.w||0,I=0;c+2<v;++c){var L=m(c),U=c&32767,_=C[L];if(w[U]=_,C[L]=U,T<=c){var k=v-c;if((A>7e3||M>24576)&&(k>423||!u)){f=Er(r,h,0,D,F,R,g,M,I,c-I,f),M=A=g=0,I=c;for(var S=0;S<286;++S)F[S]=0;for(var S=0;S<30;++S)R[S]=0}var z=2,E=0,er=x,G=U-_&32767;if(k>2&&L==m(c-G))for(var Y=Math.min(s,k)-1,P=Math.min(32767,c),$=Math.min(258,k);G<=P&&--er&&U!=_;){if(r[c+z]==r[c+z-G]){for(var b=0;b<$&&r[c+b]==r[c+b-G];++b);if(b>z){if(z=b,E=G,b>Y)break;for(var W=Math.min(G,b-2),X=0,S=0;S<W;++S){var Z=c-G+S&32767,ir=w[Z],vr=Z-ir&32767;vr>X&&(X=vr,_=Z)}}}U=_,_=w[U],G+=U-_&32767}if(E){D[M++]=268435456|dr[z]<<18|Mr[E];var ar=dr[z]&31,nr=Mr[E]&31;g+=lr[ar]+sr[nr],++F[257+ar],++R[nr],T=c+z,++A}else D[M++]=r[c],++F[r[c]]}}for(c=Math.max(c,T);c<v;++c)D[M++]=r[c],++F[r[c]];f=Er(r,h,u,D,F,R,g,M,I,c-I,f),u||(o.r=f&7|h[f/8|0]<<3,f-=7,o.h=C,o.p=w,o.i=c,o.w=T)}else{for(var c=o.w||0;c<v+u;c+=65535){var rr=c+65535;rr>=v&&(h[f/8|0]=u,rr=v),f=Ur(h,f+1,r.subarray(c,rr))}o.i=v}return cr(l,0,n+Ar(f)+t)},$r=function(){var r=1,e=0;return{p:function(a){for(var n=r,t=e,o=a.length|0,v=0;v!=o;){for(var l=Math.min(v+2655,o);v<l;++v)t+=n+=a[v];n=(n&65535)+15*(n>>16),t=(t&65535)+15*(t>>16)}r=n,e=t},d:function(){return r%=65521,e%=65521,(r&255)<<24|(r&65280)<<8|(e&255)<<8|e>>8}}},le=function(r,e,a,n,t){if(!t&&(t={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),v=new j(o.length+r.length);v.set(o),v.set(r,o.length),r=v,t.w=o.length}return ve(r,e.level==null?6:e.level,e.mem==null?t.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,a,n,t)},Br=function(r,e,a){for(;a;++e)r[e]=a,a>>>=8},se=function(r,e){var a=e.level,n=a==0?0:a<6?1:a==9?3:2;if(r[0]=120,r[1]=n<<6|(e.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,e.dictionary){var t=$r();t.p(e.dictionary),Br(r,2,t.d())}},ce=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&H(6,"invalid zlib data"),(r[1]>>5&1)==1&&H(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function ue(r,e){e||(e={});var a=$r();a.p(r);var n=le(r,e,e.dictionary?6:2,4);return se(n,e),Br(n,n.length-4,a.d()),n}function he(r,e){return fe(r.subarray(ce(r),-4),{i:2},e,e)}var Fr=typeof TextEncoder<"u"&&new TextEncoder,Tr=typeof TextDecoder<"u"&&new TextDecoder,ge=0;try{Tr.decode(Pr,{stream:!0}),ge=1}catch{}var we=function(r){for(var e="",a=0;;){var n=r[a++],t=(n>127)+(n>223)+(n>239);if(a+t>r.length)return{s:e,r:cr(r,a-1)};t?t==3?(n=((n&15)<<18|(r[a++]&63)<<12|(r[a++]&63)<<6|r[a++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):t&1?e+=String.fromCharCode((n&31)<<6|r[a++]&63):e+=String.fromCharCode((n&15)<<12|(r[a++]&63)<<6|r[a++]&63):e+=String.fromCharCode(n)}};function Ir(r,e){if(e){for(var a=new j(r.length),n=0;n<r.length;++n)a[n]=r.charCodeAt(n);return a}if(Fr)return Fr.encode(r);for(var t=r.length,o=new j(r.length+(r.length>>1)),v=0,l=function(f){o[v++]=f},n=0;n<t;++n){if(v+5>o.length){var h=new j(v+8+(t-n<<1));h.set(o),o=h}var u=r.charCodeAt(n);u<128||e?l(u):u<2048?(l(192|u>>6),l(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|r.charCodeAt(++n)&1023,l(240|u>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|u&63)):(l(224|u>>12),l(128|u>>6&63),l(128|u&63))}return cr(o,0,v)}function Or(r,e){if(e){for(var a="",n=0;n<r.length;n+=16384)a+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return a}else{if(Tr)return Tr.decode(r);var t=we(r),o=t.s,a=t.r;return a.length&&H(8),o}}const Nr="heroicons:share",xe="heroicons:check",Gr="RAGBITS-STATE",yr=`<${Gr}>`,Sr=`</${Gr}>`;function pe(r){if(typeof r!="object"||r===null)return!1;const e=r;return!(typeof e.history!="object"||"followupMessages"in e&&typeof e.followupMessages!="object"||"chatOptions"in e&&typeof e.chatOptions!="object"||"serverState"in e&&typeof e.serverState!="object"||"conversationId"in e&&typeof e.conversationId!="string"&&typeof e.conversationId!="object")}function be(){const{restore:r,getCurrentConversation:e}=Hr(),{isOpen:a,onOpen:n,onClose:t}=Jr(),[o,v]=hr.useState(Nr),l=hr.useRef(null),h=Wr(),u=()=>{const{chatOptions:i,history:s,serverState:x,conversationId:d,followupMessages:w}=e(),C=Vr({chatOptions:i,history:s,serverState:x,conversationId:d,followupMessages:w}),N=Ir(`${yr}${JSON.stringify(C)}${Sr}`),y=btoa(Or(ue(N,{level:9}),!0));navigator.clipboard.writeText(y),v(xe),t(),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{v(Nr)},2e3)},f=()=>{t()};return hr.useEffect(()=>{const i=s=>{if(!s.clipboardData){console.warn("[Share] Nothing to parse, skipping.");return}const x=s.clipboardData.types;if(!x.includes("text/plain")&&!x.includes("text")){console.warn("[Share] Invalid content type of pasted content, skipping.");return}const d=s.clipboardData.getData("text/plain")??s.clipboardData.getData("text");try{const w=atob(d);if(!w.startsWith("xÚ")){console.warn("[Share] Incorrect header, skipping.");return}const C=Or(he(Ir(w,!0)));if(!C.startsWith(yr)||!C.endsWith(Sr)){console.warn("[Share] Failed to parse as valid Ragbits state, skipping.");return}s.preventDefault(),s.stopPropagation();const N=C.slice(yr.length,-Sr.length),y=JSON.parse(N);if(!pe(y)){console.warn("[Share] Pasted state didn't pass validation, skipping.");return}const m=r(y.history,y.followupMessages,y.chatOptions,y.serverState,y.conversationId);h(Xr(m))}catch(w){console.error("[Share] Couldn't parse pasted string as valid Ragbits state",w)}};return window.addEventListener("paste",i),()=>{window.removeEventListener("paste",i)}}),O.jsxs(O.Fragment,{children:[O.jsx(qr,{content:"Share conversation",placement:"bottom",children:O.jsx(gr,{isIconOnly:!0,variant:"ghost",className:"p-0","aria-label":"Share conversation",onPress:n,children:O.jsx(Yr,{icon:o})})}),O.jsx(Kr,{isOpen:a,onOpenChange:f,children:O.jsx(Lr,{children:i=>O.jsxs(O.Fragment,{children:[O.jsx(Zr,{className:"text-default-900 flex flex-col gap-1",children:"Share conversation"}),O.jsx(Qr,{children:O.jsxs("div",{className:"flex flex-col gap-4",children:[O.jsx("p",{className:"text-medium text-default-500",children:"You are about to copy a code that allows sharing and storing your current app state. Once copied, you can paste this code anywhere on the site to instantly return to this exact setup. It’s a quick way to save your progress or share it with others."}),O.jsxs("div",{className:"flex justify-end gap-4 py-4",children:[O.jsx(gr,{color:"danger",variant:"light",onPress:i,"aria-label":"Close share modal",children:"Cancel"}),O.jsx(gr,{color:"primary",onPress:u,"aria-label":"Copy to clipboard to share the conversation",children:"Copy to clipboard"})]})]})})]})})})]})}export{be as default};
