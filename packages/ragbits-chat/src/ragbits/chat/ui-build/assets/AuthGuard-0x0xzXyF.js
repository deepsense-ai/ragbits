import{r as a,V as s,aw as c,aI as x,bF as g,aU as m,aV as p,bG as v}from"./useThemeContext-CXEHnhK-.js";import{a as r}from"./authStore-CG9vQHsZ.js";import{f as k,R as j}from"./main-9MyF3y00.js";const A=a.createContext(null);function C({children:o}){const[n]=a.useState(()=>r);return s.jsx(A.Provider,{value:n,children:o})}function R(){const{token:o,tokenExpiration:n,logout:l}=c(r,e=>e),i=k(e=>e.isLoading),u=x(),d=a.useRef(i);a.useEffect(()=>{d.current=i},[i]);const t=a.useCallback(()=>{const e=()=>{d.current?setTimeout(e,500):(l(),u("/login"))};e()},[l,u]);return a.useEffect(()=>{if(!o||!n)return;const e=Date.now(),f=n-e;if(f<=0){t();return}const h=setTimeout(()=>{t()},f);return()=>clearTimeout(h)},[o,n,t]),null}function L({children:o}){const n=g(),l=c(r,t=>t.isAuthenticated),i=c(r,t=>t.hasHydrated),u=c(r,t=>t.token?.access_token),d=c(r,t=>t.logout);return i?n.pathname==="/login"?o:l&&u?s.jsx(C,{children:s.jsxs(m,{baseUrl:p,auth:{getToken:()=>u,onUnauthorized:d},children:[o,s.jsx(R,{})]})}):s.jsx(v,{to:"/login",replace:!0}):s.jsx(j,{})}export{L as default};
