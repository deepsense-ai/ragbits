import{r as s,E as a,a4 as c,ai as x,aJ as g,au as m,av as p,aL as v}from"./useThemeContext-DkrqKvLn.js";import{a as r}from"./authStore-BZmq_GrX.js";import{d as k,I as j}from"./main-BJLJjzL4.js";const A=s.createContext(null);function C({children:o}){const[n]=s.useState(()=>r);return a.jsx(A.Provider,{value:n,children:o})}function E(){const{token:o,tokenExpiration:n,logout:l}=c(r,e=>e),i=k(e=>e.isLoading),u=x(),d=s.useRef(i);s.useEffect(()=>{d.current=i},[i]);const t=s.useCallback(()=>{const e=()=>{d.current?setTimeout(e,500):(l(),u("/login"))};e()},[l,u]);return s.useEffect(()=>{if(!o||!n)return;const e=Date.now(),f=n-e;if(f<=0){t();return}const h=setTimeout(()=>{t()},f);return()=>clearTimeout(h)},[o,n,t]),null}function P({children:o}){const n=g(),l=c(r,t=>t.isAuthenticated),i=c(r,t=>t.hasHydrated),u=c(r,t=>t.token?.access_token),d=c(r,t=>t.logout);return i?n.pathname==="/login"?o:l&&u?a.jsx(C,{children:a.jsxs(m,{baseUrl:p,auth:{getToken:()=>u,onUnauthorized:d},children:[o,a.jsx(E,{})]})}):a.jsx(v,{to:"/login",replace:!0}):a.jsx(j,{})}export{P as default};
