import{r as h,j as t,g as i,h as b,c as j,bx as f,by as l,bz as d,bA as p,bB as S}from"./index-DpOBiJiD.js";import{a as r}from"./authStore-BJzDjplU.js";import{u as m}from"./useInitializeUserStore-gUBPelSF.js";const y=h.createContext(null);function A({children:e}){const[a]=h.useState(()=>r);return t.jsx(y.Provider,{value:a,children:e})}function v(){const{logout:e,login:a,setHydrated:c}=i(r,x=>x),u=m(),n=b(),s=j("/api/user"),g=f();return h.useEffect(()=>{(async()=>{try{const o=await s.call();o?(a(o),u(o.user_id),g.pathname==="/login"&&n("/")):e()}catch(o){console.error("Failed to check session:",o),e(),n("/login")}finally{c()}})()},[]),null}function R({children:e}){const a=f(),c=i(r,s=>s.isAuthenticated),u=i(r,s=>s.hasHydrated),n=i(r,s=>s.logout);return u?a.pathname==="/login"?t.jsx(l,{baseUrl:d,auth:{credentials:"include"},children:e}):c?t.jsx(A,{children:t.jsx(l,{baseUrl:d,auth:{onUnauthorized:n,credentials:"include"},children:e})}):t.jsx(S,{to:"/login",replace:!0}):t.jsxs(l,{baseUrl:d,auth:{credentials:"include"},children:[t.jsx(v,{}),t.jsx(p,{})]})}export{R as default};
