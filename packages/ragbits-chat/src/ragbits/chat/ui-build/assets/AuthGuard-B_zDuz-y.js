import{r as h,j as e,aV as c,aD as S,c as m,bw as f,bx as l,by as d,bz as p,bA as b}from"./index-D3AOPdJ7.js";import{a}from"./authStore-Btd4zw4N.js";import{u as j}from"./useInitializeUserStore-DjforSLb.js";const y=h.createContext(null);function v({children:t}){const[o]=h.useState(()=>a);return e.jsx(y.Provider,{value:o,children:t})}function A(){const{logout:t,login:o,setHydrated:u}=c(a,x=>x),i=j(),n=S(),s=m("/api/user"),g=f();return h.useEffect(()=>{(async()=>{try{const r=await s.call();r?(o(r),i?i(r.user_id):console.error("Failed to initialize store for user, initializeUserStore() is not defined. Check current HistoryStoreContextProvider implementation."),g.pathname==="/login"&&n("/")):t()}catch(r){console.error("Failed to check session:",r),t(),n("/login")}finally{u()}})()},[]),null}function P({children:t}){const o=f(),u=c(a,s=>s.isAuthenticated),i=c(a,s=>s.hasHydrated),n=c(a,s=>s.logout);return i?o.pathname==="/login"?e.jsx(l,{baseUrl:d,auth:{credentials:"include"},children:t}):u?e.jsx(v,{children:e.jsx(l,{baseUrl:d,auth:{onUnauthorized:n,credentials:"include"},children:t})}):e.jsx(b,{to:"/login",replace:!0}):e.jsxs(l,{baseUrl:d,auth:{credentials:"include"},children:[e.jsx(A,{}),e.jsx(p,{})]})}export{P as default};
