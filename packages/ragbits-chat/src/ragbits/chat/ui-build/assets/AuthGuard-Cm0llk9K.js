import{r as a,W as s,aH as c,aS as x,bF as g,b2 as m,b3 as p,bG as v}from"./useThemeContext-BNyuoliF.js";import{a as r}from"./authStore-Dyx5eV1L.js";import{f as k,V as b}from"./main-JbhCq9DR.js";const j=a.createContext(null);function A({children:o}){const[n]=a.useState(()=>r);return s.jsx(j.Provider,{value:n,children:o})}function C(){const{token:o,tokenExpiration:n,logout:l}=c(r,e=>e),i=k(e=>e.isLoading),u=x(),d=a.useRef(i);a.useEffect(()=>{d.current=i},[i]);const t=a.useCallback(()=>{const e=()=>{d.current?setTimeout(e,500):(l(),u("/login"))};e()},[l,u]);return a.useEffect(()=>{if(!o||!n)return;const e=Date.now(),f=n-e;if(f<=0){t();return}const h=setTimeout(()=>{t()},f);return()=>clearTimeout(h)},[o,n,t]),null}function L({children:o}){const n=g(),l=c(r,t=>t.isAuthenticated),i=c(r,t=>t.hasHydrated),u=c(r,t=>t.token?.access_token),d=c(r,t=>t.logout);return i?n.pathname==="/login"?o:l&&u?s.jsx(A,{children:s.jsxs(m,{baseUrl:p,auth:{getToken:()=>u,onUnauthorized:d},children:[o,s.jsx(C,{})]})}):s.jsx(v,{to:"/login",replace:!0}):s.jsx(b,{})}export{L as default};
